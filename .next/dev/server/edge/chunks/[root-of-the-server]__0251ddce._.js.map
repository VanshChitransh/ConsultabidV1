{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\n// Reuse a single PrismaClient instance across hot reloads to avoid exhausting connections.\nconst globalForPrisma = globalThis as unknown as { prisma?: PrismaClient };\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n  });\n\nif (process.env.NODE_ENV !== 'production') {\n  globalForPrisma.prisma = prisma;\n}\n\nexport type PrismaClientType = typeof prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,2FAA2F;AAC3F,MAAM,kBAAkB;AAEjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,oTAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B"}},
    {"offset": {"line": 38, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/env.ts"],"sourcesContent":["'use server';\n\nimport { z } from 'zod';\n\nconst envSchema = z.object({\n  DATABASE_URL: z.string().url(),\n  NEXTAUTH_SECRET: z.string().min(1, 'NEXTAUTH_SECRET is required'),\n  NEXTAUTH_URL: z.string().url().optional(),\n  GOOGLE_CLIENT_ID: z.string().min(1, 'GOOGLE_CLIENT_ID is required'),\n  GOOGLE_CLIENT_SECRET: z.string().min(1, 'GOOGLE_CLIENT_SECRET is required'),\n  EMAIL_SERVER: z.string().min(1, 'EMAIL_SERVER is required'),\n  EMAIL_FROM: z.string().min(1, 'EMAIL_FROM is required'),\n  ADMIN_EMAILS: z.string().optional().default(''),\n  DEVELOPER_EMAILS: z.string().optional().default(''),\n  R2_ACCOUNT_ID: z.string().min(1, 'R2_ACCOUNT_ID is required'),\n  R2_ACCESS_KEY_ID: z.string().min(1, 'R2_ACCESS_KEY_ID is required'),\n  R2_SECRET_ACCESS_KEY: z.string().min(1, 'R2_SECRET_ACCESS_KEY is required'),\n  R2_BUCKET_NAME: z.string().min(1, 'R2_BUCKET_NAME is required'),\n  R2_ENDPOINT: z.string().url().optional(),\n  R2_PUBLIC_URL: z.string().url(),\n});\n\nconst parsedEnv = envSchema.safeParse(process.env);\n\nif (!parsedEnv.success) {\n  const errorMessage = JSON.stringify(parsedEnv.error.flatten().fieldErrors, null, 2);\n  throw new Error(`Invalid environment variables: ${errorMessage}`);\n}\n\n\nconst parseEmailList = (value: string) =>\n  value\n    .split(',')\n    .map((email) => email.trim().toLowerCase())\n    .filter(Boolean);\n\n    \n\nexport const env = parsedEnv.data;\nexport type Env = typeof env;\nexport { envSchema };\n\nexport const adminEmails = parseEmailList(env.ADMIN_EMAILS);\nexport const developerEmails = parseEmailList(env.DEVELOPER_EMAILS);\n"],"names":[],"mappings":";;;;;;;;;;AAEA;AAFA;;AAIA,MAAM,YAAY,iOAAC,CAAC,MAAM,CAAC;IACzB,cAAc,iOAAC,CAAC,MAAM,GAAG,GAAG;IAC5B,iBAAiB,iOAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACnC,cAAc,iOAAC,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ;IACvC,kBAAkB,iOAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACpC,sBAAsB,iOAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACxC,cAAc,iOAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAChC,YAAY,iOAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC9B,cAAc,iOAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,OAAO,CAAC;IAC5C,kBAAkB,iOAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,OAAO,CAAC;IAChD,eAAe,iOAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACjC,kBAAkB,iOAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACpC,sBAAsB,iOAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACxC,gBAAgB,iOAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAClC,aAAa,iOAAC,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ;IACtC,eAAe,iOAAC,CAAC,MAAM,GAAG,GAAG;AAC/B;AAEA,MAAM,YAAY,UAAU,SAAS,CAAC,QAAQ,GAAG;AAEjD,IAAI,CAAC,UAAU,OAAO,EAAE;IACtB,MAAM,eAAe,KAAK,SAAS,CAAC,UAAU,KAAK,CAAC,OAAO,GAAG,WAAW,EAAE,MAAM;IACjF,MAAM,IAAI,MAAM,CAAC,+BAA+B,EAAE,cAAc;AAClE;AAGA,MAAM,iBAAiB,CAAC,QACtB,MACG,KAAK,CAAC,KACN,GAAG,CAAC,CAAC,QAAU,MAAM,IAAI,GAAG,WAAW,IACvC,MAAM,CAAC;AAIL,MAAM,MAAM,UAAU,IAAI;;AAI1B,MAAM,cAAc,eAAe,IAAI,YAAY;AACnD,MAAM,kBAAkB,eAAe,IAAI,gBAAgB"}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse, type NextRequest } from 'next/server';\nimport { getToken } from 'next-auth/jwt';\n\nimport { prisma } from '@/src/lib/prisma';\nimport { adminEmails, developerEmails, env } from '@/src/lib/env';\n\nconst TWO_HOURS_MS = 2 * 60 * 60 * 1000;\n\nconst isProcessingRoute = (pathname: string) => pathname.includes('/process-estimate');\n\nconst isAdminOrDeveloper = (email?: string | null) => {\n  if (!email) {\n    return false;\n  }\n  const normalized = email.toLowerCase();\n  return adminEmails.includes(normalized) || developerEmails.includes(normalized);\n};\n\nconst getRemainingWaitMs = async (userId: string) => {\n  const latestEstimate = await prisma.estimate.findFirst({\n    where: {\n      userId,\n      processingStartedAt: {\n        not: null,\n      },\n    },\n    orderBy: {\n      processingStartedAt: 'desc',\n    },\n    select: {\n      processingStartedAt: true,\n    },\n  });\n\n  if (!latestEstimate?.processingStartedAt) {\n    return null;\n  }\n\n  const startedAtMs = new Date(latestEstimate.processingStartedAt).getTime();\n  const elapsedMs = Date.now() - startedAtMs;\n  const remainingMs = TWO_HOURS_MS - elapsedMs;\n\n  if (remainingMs > 0) {\n    return remainingMs;\n  }\n\n  return null;\n};\n\nexport const middleware = async (req: NextRequest) => {\n  const token = await getToken({ req, secret: env.NEXTAUTH_SECRET });\n\n  if (!token?.sub) {\n    return NextResponse.json(\n      { success: false, error: 'Unauthorized' },\n      { status: 401 }\n    );\n  }\n\n  const pathname = req.nextUrl.pathname;\n\n  if (isProcessingRoute(pathname) && !isAdminOrDeveloper(token.email)) {\n    const remainingMs = await getRemainingWaitMs(token.sub);\n\n    if (remainingMs !== null) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Please wait before generating another estimate',\n          remainingTime: remainingMs,\n        },\n        { status: 429 }\n      );\n    }\n  }\n\n  return NextResponse.next();\n};\n\nexport const config = {\n  matcher: ['/api/files/:path*', '/api/estimate/:path*'],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AAEA;AACA;;;;;AAEA,MAAM,eAAe,IAAI,KAAK,KAAK;AAEnC,MAAM,oBAAoB,CAAC,WAAqB,SAAS,QAAQ,CAAC;AAElE,MAAM,qBAAqB,CAAC;IAC1B,IAAI,CAAC,OAAO;QACV,OAAO;IACT;IACA,MAAM,aAAa,MAAM,WAAW;IACpC,OAAO,wIAAW,CAAC,QAAQ,CAAC,eAAe,4IAAe,CAAC,QAAQ,CAAC;AACtE;AAEA,MAAM,qBAAqB,OAAO;IAChC,MAAM,iBAAiB,MAAM,sIAAM,CAAC,QAAQ,CAAC,SAAS,CAAC;QACrD,OAAO;YACL;YACA,qBAAqB;gBACnB,KAAK;YACP;QACF;QACA,SAAS;YACP,qBAAqB;QACvB;QACA,QAAQ;YACN,qBAAqB;QACvB;IACF;IAEA,IAAI,CAAC,gBAAgB,qBAAqB;QACxC,OAAO;IACT;IAEA,MAAM,cAAc,IAAI,KAAK,eAAe,mBAAmB,EAAE,OAAO;IACxE,MAAM,YAAY,KAAK,GAAG,KAAK;IAC/B,MAAM,cAAc,eAAe;IAEnC,IAAI,cAAc,GAAG;QACnB,OAAO;IACT;IAEA,OAAO;AACT;AAEO,MAAM,aAAa,OAAO;IAC/B,MAAM,QAAQ,MAAM,IAAA,qXAAQ,EAAC;QAAE;QAAK,QAAQ,gIAAG,CAAC,eAAe;IAAC;IAEhE,IAAI,CAAC,OAAO,KAAK;QACf,OAAO,iWAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAe,GACxC;YAAE,QAAQ;QAAI;IAElB;IAEA,MAAM,WAAW,IAAI,OAAO,CAAC,QAAQ;IAErC,IAAI,kBAAkB,aAAa,CAAC,mBAAmB,MAAM,KAAK,GAAG;QACnE,MAAM,cAAc,MAAM,mBAAmB,MAAM,GAAG;QAEtD,IAAI,gBAAgB,MAAM;YACxB,OAAO,iWAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,OAAO;gBACP,eAAe;YACjB,GACA;gBAAE,QAAQ;YAAI;QAElB;IACF;IAEA,OAAO,iWAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAqB;KAAuB;AACxD"}}]
}